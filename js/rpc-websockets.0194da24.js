import{r as D,b as j,i as I,d as K,e as Q,f as V,h as N,j as $,k as A,g as F}from"./@babel.f1e6723f.js";var W={},L={exports:{}},T;function G(){return T||(T=1,function(C){var g=Object.prototype.hasOwnProperty,p="~";function w(){}Object.create&&(w.prototype=Object.create(null),new w().__proto__||(p=!1));function O(f,a,s){this.fn=f,this.context=a,this.once=s||!1}function P(f,a,s,c,y){if(typeof s!="function")throw new TypeError("The listener must be a function");var _=new O(s,c||f,y),d=p?p+a:a;return f._events[d]?f._events[d].fn?f._events[d]=[f._events[d],_]:f._events[d].push(_):(f._events[d]=_,f._eventsCount++),f}function b(f,a){--f._eventsCount===0?f._events=new w:delete f._events[a]}function h(){this._events=new w,this._eventsCount=0}h.prototype.eventNames=function(){var a=[],s,c;if(this._eventsCount===0)return a;for(c in s=this._events)g.call(s,c)&&a.push(p?c.slice(1):c);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(s)):a},h.prototype.listeners=function(a){var s=p?p+a:a,c=this._events[s];if(!c)return[];if(c.fn)return[c.fn];for(var y=0,_=c.length,d=new Array(_);y<_;y++)d[y]=c[y].fn;return d},h.prototype.listenerCount=function(a){var s=p?p+a:a,c=this._events[s];return c?c.fn?1:c.length:0},h.prototype.emit=function(a,s,c,y,_,d){var k=p?p+a:a;if(!this._events[k])return!1;var t=this._events[k],m=arguments.length,l,r;if(t.fn){switch(t.once&&this.removeListener(a,t.fn,void 0,!0),m){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,s),!0;case 3:return t.fn.call(t.context,s,c),!0;case 4:return t.fn.call(t.context,s,c,y),!0;case 5:return t.fn.call(t.context,s,c,y,_),!0;case 6:return t.fn.call(t.context,s,c,y,_,d),!0}for(r=1,l=new Array(m-1);r<m;r++)l[r-1]=arguments[r];t.fn.apply(t.context,l)}else{var n=t.length,v;for(r=0;r<n;r++)switch(t[r].once&&this.removeListener(a,t[r].fn,void 0,!0),m){case 1:t[r].fn.call(t[r].context);break;case 2:t[r].fn.call(t[r].context,s);break;case 3:t[r].fn.call(t[r].context,s,c);break;case 4:t[r].fn.call(t[r].context,s,c,y);break;default:if(!l)for(v=1,l=new Array(m-1);v<m;v++)l[v-1]=arguments[v];t[r].fn.apply(t[r].context,l)}}return!0},h.prototype.on=function(a,s,c){return P(this,a,s,c,!1)},h.prototype.once=function(a,s,c){return P(this,a,s,c,!0)},h.prototype.removeListener=function(a,s,c,y){var _=p?p+a:a;if(!this._events[_])return this;if(!s)return b(this,_),this;var d=this._events[_];if(d.fn)d.fn===s&&(!y||d.once)&&(!c||d.context===c)&&b(this,_);else{for(var k=0,t=[],m=d.length;k<m;k++)(d[k].fn!==s||y&&!d[k].once||c&&d[k].context!==c)&&t.push(d[k]);t.length?this._events[_]=t.length===1?t[0]:t:b(this,_)}return this},h.prototype.removeAllListeners=function(a){var s;return a?(s=p?p+a:a,this._events[s]&&b(this,s)):(this._events=new w,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=p,h.EventEmitter=h,C.exports=h}(L)),L.exports}var R={},B;function X(){if(B)return R;B=1;var C=I;Object.defineProperty(R,"__esModule",{value:!0}),R.DefaultDataPack=void 0,R.createError=P;var g=C(D()),p=C(j()),w=new Map([[-32e3,"Event not provided"],[-32600,"Invalid Request"],[-32601,"Method not found"],[-32602,"Invalid params"],[-32603,"Internal error"],[-32604,"Params not found"],[-32605,"Method forbidden"],[-32606,"Event forbidden"],[-32700,"Parse error"]]),O=function(){function b(){(0,g.default)(this,b)}return(0,p.default)(b,[{key:"encode",value:function(f){return JSON.stringify(f)}},{key:"decode",value:function(f){return JSON.parse(f)}}]),b}();R.DefaultDataPack=O;function P(b,h){var f={code:b,message:w.get(b)||"Internal Server Error"};return h&&(f.data=h),f}return R}(function(C){var g=I;Object.defineProperty(C,"__esModule",{value:!0}),C.default=void 0;var p=g(K()),w=g(Q()),O=g(V()),P=g(D()),b=g(j()),h=g(N()),f=g($()),a=g(A()),s=G(),c=X();function y(t){var m=_();return function(){var r=(0,a.default)(t),n;if(m){var v=(0,a.default)(this).constructor;n=Reflect.construct(r,arguments,v)}else n=r.apply(this,arguments);return(0,f.default)(this,n)}}function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var d=function(t,m){var l={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&m.indexOf(r)<0&&(l[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)m.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(l[r[n]]=t[r[n]]);return l},k=function(t){(0,h.default)(l,t);var m=y(l);function l(r){var n,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"ws://localhost:8080",e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;(0,P.default)(this,l);var u=e.autoconnect,E=u===void 0?!0:u,q=e.reconnect,S=q===void 0?!0:q,x=e.reconnect_interval,U=x===void 0?1e3:x,M=e.max_reconnects,z=M===void 0?5:M,H=d(e,["autoconnect","reconnect","reconnect_interval","max_reconnects"]);return n=m.call(this),n.webSocketFactory=r,n.queue={},n.rpc_id=0,n.address=v,n.autoconnect=E,n.ready=!1,n.reconnect=S,n.reconnect_timer_id=void 0,n.reconnect_interval=U,n.max_reconnects=z,n.rest_options=H,n.current_reconnects=0,n.generate_request_id=i||function(){return++n.rpc_id},o?n.dataPack=o:n.dataPack=new c.DefaultDataPack,n.autoconnect&&n._connect(n.address,Object.assign({autoconnect:n.autoconnect,reconnect:n.reconnect,reconnect_interval:n.reconnect_interval,max_reconnects:n.max_reconnects},n.rest_options)),n}return(0,b.default)(l,[{key:"connect",value:function(){this.socket||this._connect(this.address,Object.assign({autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects},this.rest_options))}},{key:"call",value:function(n,v,e,i){var o=this;return!i&&(0,O.default)(e)==="object"&&(i=e,e=null),new Promise(function(u,E){if(!o.ready)return E(new Error("socket not ready"));var q=o.generate_request_id(n,v),S={jsonrpc:"2.0",method:n,params:v||void 0,id:q};o.socket.send(o.dataPack.encode(S),i,function(x){if(x)return E(x);o.queue[q]={promise:[u,E]},e&&(o.queue[q].timeout=setTimeout(function(){delete o.queue[q],E(new Error("reply timeout"))},e))})})}},{key:"login",value:function(){var r=(0,w.default)(p.default.mark(function v(e){var i;return p.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.call("rpc.login",e);case 2:if(i=u.sent,i){u.next=5;break}throw new Error("authentication failed");case 5:return u.abrupt("return",i);case 6:case"end":return u.stop()}},v,this)}));function n(v){return r.apply(this,arguments)}return n}()},{key:"listMethods",value:function(){var r=(0,w.default)(p.default.mark(function v(){return p.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.call("__listMethods");case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},v,this)}));function n(){return r.apply(this,arguments)}return n}()},{key:"notify",value:function(n,v){var e=this;return new Promise(function(i,o){if(!e.ready)return o(new Error("socket not ready"));var u={jsonrpc:"2.0",method:n,params:v};e.socket.send(e.dataPack.encode(u),function(E){if(E)return o(E);i()})})}},{key:"subscribe",value:function(){var r=(0,w.default)(p.default.mark(function v(e){var i;return p.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return typeof e=="string"&&(e=[e]),u.next=3,this.call("rpc.on",e);case 3:if(i=u.sent,!(typeof e=="string"&&i[e]!=="ok")){u.next=6;break}throw new Error("Failed subscribing to an event '"+e+"' with: "+i[e]);case 6:return u.abrupt("return",i);case 7:case"end":return u.stop()}},v,this)}));function n(v){return r.apply(this,arguments)}return n}()},{key:"unsubscribe",value:function(){var r=(0,w.default)(p.default.mark(function v(e){var i;return p.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return typeof e=="string"&&(e=[e]),u.next=3,this.call("rpc.off",e);case 3:if(i=u.sent,!(typeof e=="string"&&i[e]!=="ok")){u.next=6;break}throw new Error("Failed unsubscribing from an event with: "+i);case 6:return u.abrupt("return",i);case 7:case"end":return u.stop()}},v,this)}));function n(v){return r.apply(this,arguments)}return n}()},{key:"close",value:function(n,v){this.socket.close(n||1e3,v)}},{key:"_connect",value:function(n,v){var e=this;clearTimeout(this.reconnect_timer_id),this.socket=this.webSocketFactory(n,v),this.socket.addEventListener("open",function(){e.ready=!0,e.emit("open"),e.current_reconnects=0}),this.socket.addEventListener("message",function(i){var o=i.data;o instanceof ArrayBuffer&&(o=Buffer.from(o).toString());try{o=e.dataPack.decode(o)}catch{return}if(o.notification&&e.listeners(o.notification).length){if(!Object.keys(o.params).length)return e.emit(o.notification);var u=[o.notification];if(o.params.constructor===Object)u.push(o.params);else for(var E=0;E<o.params.length;E++)u.push(o.params[E]);return Promise.resolve().then(function(){e.emit.apply(e,u)})}if(!e.queue[o.id])return o.method&&o.params?Promise.resolve().then(function(){e.emit(o.method,o.params)}):void 0;"error"in o=="result"in o&&e.queue[o.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),e.queue[o.id].timeout&&clearTimeout(e.queue[o.id].timeout),o.error?e.queue[o.id].promise[1](o.error):e.queue[o.id].promise[0](o.result),delete e.queue[o.id]}),this.socket.addEventListener("error",function(i){return e.emit("error",i)}),this.socket.addEventListener("close",function(i){var o=i.code,u=i.reason;e.ready&&setTimeout(function(){return e.emit("close",o,u)},0),e.ready=!1,e.socket=void 0,o!==1e3&&(e.current_reconnects++,e.reconnect&&(e.max_reconnects>e.current_reconnects||e.max_reconnects===0)&&(e.reconnect_timer_id=setTimeout(function(){return e._connect(n,v)},e.reconnect_interval)))})}}]),l}(s.EventEmitter);C.default=k})(W);const Z=F(W);var J={};(function(C){var g=I;Object.defineProperty(C,"__esModule",{value:!0}),C.default=c;var p=g(D()),w=g(j()),O=g(N()),P=g($()),b=g(A()),h=G();function f(y){var _=a();return function(){var k=(0,b.default)(y),t;if(_){var m=(0,b.default)(this).constructor;t=Reflect.construct(k,arguments,m)}else t=k.apply(this,arguments);return(0,P.default)(this,t)}}function a(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var s=function(y){(0,O.default)(d,y);var _=f(d);function d(k,t,m){var l;return(0,p.default)(this,d),l=_.call(this),l.socket=new window.WebSocket(k,m),l.socket.onopen=function(){return l.emit("open")},l.socket.onmessage=function(r){return l.emit("message",r.data)},l.socket.onerror=function(r){return l.emit("error",r)},l.socket.onclose=function(r){l.emit("close",r.code,r.reason)},l}return(0,w.default)(d,[{key:"send",value:function(t,m,l){var r=l||m;try{this.socket.send(t),r()}catch(n){r(n)}}},{key:"close",value:function(t,m){this.socket.close(t,m)}},{key:"addEventListener",value:function(t,m,l){this.socket.addEventListener(t,m,l)}}]),d}(h.EventEmitter);function c(y,_){return new s(y,_)}})(J);const ee=F(J);export{Z as R,ee as c};
